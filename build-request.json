{
  "kind": "build_request",
  "title": "Replace backgroundSphere fragmentShader in CubeVisualization.tsx",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In frontend/src/components/CubeVisualization.tsx, replace ONLY the string content of the backgroundSphere's fragmentShader constant with the new FBM-based nebula shader provided below. Do not modify the vertexShader, useFrame logic, component settings, uniforms setup, or any other part of the file.\n\nNew fragmentShader content:\n```glsl\nuniform float time;\nuniform vec2 resolution;\n\n#define NUM_OCTAVES 6\n\nfloat random(vec2 pos) {\n    return fract(sin(dot(pos.xy, vec2(13.9898, 78.233))) * 43758.5453123);\n}\n\nfloat noise(vec2 pos) {\n    vec2 i = floor(pos);\n    vec2 f = fract(pos);\n    float a = random(i + vec2(0.0, 0.0));\n    float b = random(i + vec2(1.0, 0.0));\n    float c = random(i + vec2(0.0, 1.0));\n    float d = random(i + vec2(1.0, 1.0));\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\nfloat fbm(vec2 pos) {\n    float v = 0.0;\n    float a = 0.5;\n    vec2 shift = vec2(100.0);\n    mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.5));\n    for (int i = 0; i < NUM_OCTAVES; i++) {\n        float dir = mod(float(i), 2.0) > 0.5 ? 1.0 : -1.0;\n        v += a * noise(pos - 0.05 * dir * time * 0.2);\n        pos = rot * pos * 2.0 + shift;\n        a *= 0.5;\n    }\n    return v;\n}\n\nvoid main() {\n    vec2 p = (gl_FragCoord.xy * 2.0 - resolution.xy) / min(resolution.x, resolution.y);\n    \n    vec3 c1 = vec3(0.2, 0.4, 0.9);\n    vec3 c2 = vec3(1.0, 0.1, 0.6);\n    vec3 c3 = vec3(0.3, 0.0, 0.5);\n    vec3 c4 = vec3(0.0, 0.0, 0.02);\n\n    float time2 = time * 0.2;\n    vec2 q = vec2(fbm(p + 0.0 * time2), fbm(p + vec2(1.0)));\n    vec2 r = vec2(fbm(p + q + vec2(1.7, 1.2) + 0.15 * time2), fbm(p + q + vec2(8.3, 2.8) + 0.126 * time2));\n    float f = fbm(p + r);\n\n    vec3 color = mix(c1, c2, clamp(f * 1.2, 0.0, 1.0));\n    color = mix(color, c3, clamp(length(q) * 1.1, 0.0, 1.0));\n    \n    float blackMask = smoothstep(0.2, 0.8, length(r.x) * 0.7);\n    color = mix(color, c4, blackMask);\n\n    color = (f * f * f * 1.5 + 0.5 * f) * color;\n    \n    gl_FragColor = vec4(pow(color, vec3(2.0)) * 5.0, 1.0);\n}\n```",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Замени только содержимое константы нашей backgroundsphere (анимированного заднего фона облаков) fragmentShader в файле CubeVisualization.tsx на этот чистый код. Больше ничего в файле не трогай — ни vertexShader, ни логику useFrame, ни настройки компонента."
        ]
      },
      "acceptanceCriteria": [
        "The backgroundSphere fragmentShader constant in CubeVisualization.tsx contains exactly the new FBM nebula shader code provided by the user.",
        "The vertexShader constant for the backgroundSphere is unchanged.",
        "The useFrame logic is unchanged.",
        "All component props, uniform declarations, and mesh/material setup are unchanged.",
        "The animated background renders a blue/pink/purple nebula cloud effect driven by the time and resolution uniforms.",
        "No other files in the project are modified."
      ]
    }
  ],
  "constraints": [
    "Only the fragmentShader string content for the backgroundSphere may be changed in CubeVisualization.tsx — no other lines in that file should be touched.",
    "Do not modify any backend files.",
    "Do not modify any other frontend files."
  ],
  "nonGoals": [
    "Changing the vertexShader",
    "Modifying useFrame animation logic",
    "Modifying component props or configuration",
    "Changing uniform declarations or material setup",
    "Any visual or functional changes to other parts of the app"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}