{
  "kind": "build_request",
  "title": "LandModel.tsx: Preserve unique per-biome emissive intensity while pulsing",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update `frontend/src/components/LandModel.tsx` material initialization so each biome’s mesh gets its own specific `emissiveIntensity` value set first (e.g., Snow = 2.0, Plains = 1.3), and only after that, persist the per-mesh baseline with `child.material.userData.baseEmissive = child.material.emissiveIntensity` (so the baseline remains unique per biome/mesh).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-6"
        ],
        "quotes": [
          "We must preserve the UNIQUE emissive intensity for each biome.",
          "ensure you set the specific intensity for each biome (e.g., 2.0 for Snow, 1.3 for Plains) FIRST. ONLY AFTER the intensity is set, save it to userData: `child.material.userData.baseEmissive = child.material.emissiveIntensity;`"
        ]
      },
      "acceptanceCriteria": [
        "When loading different biome models (e.g., `SNOW_PEAK.glb` vs others), meshes retain distinct baseline emissive brightness values rather than being normalized to a single shared value.",
        "`userData.baseEmissive` is written after `emissiveIntensity` is assigned for that mesh/material and matches the final assigned baseline value.",
        "No mesh that should pulse ends up with an incorrect `baseEmissive` due to initialization order."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Refine the emissive pulse in `frontend/src/components/LandModel.tsx` so the `useFrame` loop uses `group.current.traverse(...)` and sets `material.emissiveIntensity = material.userData.baseEmissive * pulse` for any traversed mesh whose material has `userData.baseEmissive` defined, ensuring the pulse scales each biome’s unique baseline rather than overwriting it.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Make sure the pulse logic uses `group.current.traverse` and multiplies the `baseEmissive` (which is now unique for each land)."
        ]
      },
      "acceptanceCriteria": [
        "The `useFrame` implementation traverses via `group.current.traverse` and multiplies `baseEmissive` by the pulse factor.",
        "All pulsing biomes “breathe” in sync (same pulse phase), but with different absolute brightness matching their unique baselines (e.g., Snow stays brighter than Plains)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Ensure dithering is applied to all land mesh materials during the same material setup traversal in `frontend/src/components/LandModel.tsx` (i.e., `child.material.dithering = true` for every mesh material processed).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Ensure child.material.dithering = true; is applied to all materials in the same loop."
        ]
      },
      "acceptanceCriteria": [
        "All `MeshStandardMaterial` instances encountered during model traversal have `dithering` enabled (not only glow meshes)."
      ]
    }
  ],
  "constraints": [
    "Frontend immutable paths must not be modified (per SYSTEM_CONTEXT).",
    "Keep changes scoped to `frontend/src/components/LandModel.tsx` for this request.",
    "Do not change Bloom or tone mapping configuration elsewhere while implementing this LandModel emissive fix (per project state architectural notes)."
  ],
  "nonGoals": [
    "No backend (Motoko) changes.",
    "No changes to `frontend/src/components/CubeVisualization.tsx` beyond what is required for LandModel to function.",
    "No new libraries or rendering/post-processing features beyond the emissive baseline + pulse + dithering fix."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}