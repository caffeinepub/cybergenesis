{
  "kind": "build_request",
  "title": "Apply final “Studio Balance” shader + fog tuning in CubeVisualization",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update `frontend/src/components/CubeVisualization.tsx` `BackgroundSphere` fragment shader to use the final “Studio Balance” colors and falloff:\n- Set `centerColor` to `vec3(1.6, 0.4, 3.2)`\n- Keep `edgeColor` as `vec3(0.0, 0.0, 0.0)`\n- Change the mixing falloff to `float d = pow(distance, 1.8);`",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-7",
          "msg-9"
        ],
        "quotes": [
          "Let's apply the final \"Studio Balance\" to CubeVisualization.tsx:\n\n1. **Background Intensity (The Sweet Spot):**\n   In fragmentShader, set colors to:\n   `vec3 centerColor = vec3(1.6, 0.4, 3.2);` // Vivid Violet\n   `vec3 edgeColor = vec3(0.0, 0.0, 0.0);`\n\n2. **Gradient Shape (Sharp Falloff):**\n   Change the mixing line to:\n   `float d = pow(distance, 1.8);`",
          "Build"
        ]
      },
      "acceptanceCriteria": [
        "`BackgroundSphere` fragment shader uses `vec3 centerColor = vec3(1.6, 0.4, 3.2);` and `vec3 edgeColor = vec3(0.0, 0.0, 0.0);`.",
        "`BackgroundSphere` falloff uses `float d = pow(distance, 1.8);` and still mixes via `mix(centerColor, edgeColor, d)`.",
        "App compiles with no TypeScript/ESLint errors after shader edits."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure `frontend/src/components/CubeVisualization.tsx` `BackgroundSphere` material settings remain: `fog={false}` and `side={THREE.BackSide}`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-7"
        ],
        "quotes": [
          "3. **BackgroundSphere Properties:**\n   Ensure `fog={false}` and `side={THREE.BackSide}` are still there."
        ]
      },
      "acceptanceCriteria": [
        "`BackgroundSphere` renders with `side={THREE.BackSide}`.",
        "`BackgroundSphere` shader material has `fog={false}` explicitly set."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update `frontend/src/components/CubeVisualization.tsx` scene fog to “Deep Space” in `SceneSetup`:\n- Use `new THREE.FogExp2(0x05010a, 0.0015)`",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-7"
        ],
        "quotes": [
          "4. **Fog Color (Deep Space):**\n   Make sure scene.fog is `0x05010a` (almost black violet) with density `0.0015`."
        ]
      },
      "acceptanceCriteria": [
        "`SceneSetup` sets `scene.fog = new THREE.FogExp2(0x05010a, 0.0015)`.",
        "Fog density remains `0.0015`."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Preserve the renderer tone mapping exposure in `frontend/src/components/CubeVisualization.tsx` at `gl.toneMappingExposure = 0.6` while applying the Studio Balance shader and fog changes.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-7"
        ],
        "quotes": [
          "This setup will pass the 0.6 exposure check and trigger a controlled Bloom without washing out the land model."
        ]
      },
      "acceptanceCriteria": [
        "`gl.toneMappingExposure` remains set to `0.6` (no change).",
        "After changes, bloom remains enabled and the scene does not whiteout from the background glow at exposure 0.6."
      ]
    }
  ],
  "constraints": [
    "Frontend immutable paths listed in SYSTEM_CONTEXT must not be edited.",
    "Keep all Motoko backend code unchanged (no backend changes required for this request)."
  ],
  "nonGoals": [
    "Do not change bloom pass parameters (strength/radius/threshold) unless explicitly requested.",
    "Do not change lighting configuration (Environment preset, key light, sun light) unless explicitly requested."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}