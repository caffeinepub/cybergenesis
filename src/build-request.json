{
  "kind": "build_request",
  "title": "Apply exact user-provided fragment shader to CubeVisualization background sphere with time/resolution uniforms",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In `frontend/src/components/CubeVisualization.tsx`, update the `BackgroundSphere` shader material to use the user-provided fragment shader code EXACTLY as written (verbatim), without modifying `gl_FragCoord` scaling, loop logic, comments, or any other shader logic.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Use the code below EXACTLY as written. Do not change `gl_FragCoord` scaling or loop logic.",
          "Here is the final shader code (User's logic + Our Brand Colors):"
        ]
      },
      "acceptanceCriteria": [
        "`BackgroundSphere`'s `fragmentShader` string content matches the user-provided GLSL exactly (including `#ifdef GL_ES`, `#extension`, `#define NUM_OCTAVES 6`, uniform names `time` and `resolution`, and the provided `main()` implementation).",
        "No additional masking, coordinate squeezing, or substitutions (e.g., `uTime` vs `time`) are introduced inside the fragment shader source.",
        "The app builds without shader compilation errors."
      ]
    },
    {
      "id": "REQ-2",
      "text": "In `frontend/src/components/CubeVisualization.tsx` `BackgroundSphere`, wire shader uniforms to match the fragment shader variable names: pass `time` (float) from `state.clock.elapsedTime` and `resolution` (vec2) from the React Three Fiber `size.width` and `size.height` values.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-6"
        ],
        "quotes": [
          "Pass the uniforms `time` (instead of uTime) and `resolution` (vec2) to match this shader's variable names.",
          "time should come from state.clock.elapsedTime.\n\nresolution should come from size.width and size.height from the Three.js state."
        ]
      },
      "acceptanceCriteria": [
        "`shaderMaterial.uniforms` includes `time` and `resolution` (and does not rely on `uTime`).",
        "On each frame (or otherwise kept current), `time` is updated using the render loop clock elapsed time.",
        "`resolution` reflects the current canvas size and updates correctly when the canvas is resized."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Ensure the fragment shader is applied to the existing background sphere mesh in `CubeVisualization.tsx` with `sphereGeometry` radius `300`, centered at `[0, 0, 0]`, and rendered from the inside by using `THREE.BackSide` or `THREE.DoubleSide` on the shader material.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Apply this shader to the Background Sphere mesh (radius 300) in CubeVisualization.tsx.",
          "Use THREE.BackSide or THREE.DoubleSide for the material so the shader is visible from the inside.",
          "Ensure the sphere is centered at [0, 0, 0] so the camera stays inside it."
        ]
      },
      "acceptanceCriteria": [
        "`BackgroundSphere` uses `sphereGeometry args={[300, ...]}`.",
        "The background sphere mesh position remains `[0, 0, 0]`.",
        "The shader material `side` is set to `THREE.BackSide` or `THREE.DoubleSide`, and the shader is visible from inside the sphere."
      ]
    }
  ],
  "constraints": [
    "Do not modify the provided fragment shader code (must be used verbatim).",
    "Do not change `gl_FragCoord` scaling or any loop logic in the fragment shader.",
    "Uniforms must be named exactly `time` and `resolution` to match the shader.",
    "All changes must remain within the existing React + React Three Fiber + Three.js frontend stack; do not add new backend services."
  ],
  "nonGoals": [
    "Changing postprocessing/bloom settings (unless required to prevent the shader from rendering at all).",
    "Adding new UI features unrelated to the background shader application.",
    "Modifying backend canister logic (Motoko) or introducing schema migrations."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}