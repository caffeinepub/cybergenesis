{
  "kind": "build_request",
  "title": "Update CubeVisualization background fragment shader main() to remove edge mask and fix scaling",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In `frontend/src/components/CubeVisualization.tsx`, update the `BackgroundSphere` fragment shader by replacing the entire `void main()` block with the exact GLSL code provided by the user (including comments), so the shader no longer applies any `edgeMask` or coordinate squeezing and the nebula fills the entire background sphere (sphereGeometry radius 300) without circular borders.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Replace the entire `void main()` block in the fragment shader with this exact code:\n\nvoid main() {\n    // 1. Scale coordinates to fill the sphere properly\n    vec2 p = vViewPosition.xy * 0.0005; \n    \n    // 2. Time-based animation\n    float t = uTime * 0.05;\n    \n    // 3. Noise and Domain Warping logic\n    vec2 n = vec2(0.0);\n    vec2 cp = p;\n    float f = 0.0;\n    float weight = 0.5;\n    for(int i = 0; i < 5; i++) {\n        f += weight * noise(cp + t);\n        cp *= 2.0;\n        weight *= 0.5;\n    }\n    \n    // 4. Custom Colors\n    vec3 blackVoid = vec3(0.01, 0.0, 0.02);\n    vec3 deepViolet = vec3(0.1, 0.02, 0.2);\n    vec3 brightNeon = vec3(0.4, 0.1, 0.6);\n    \n    vec3 color = mix(blackVoid, deepViolet, f);\n    color = mix(color, brightNeon, f * f);\n\n    // REMOVED: edgeMask and coordinate squeezing\n    \n    gl_FragColor = vec4(color * 1.5, 1.0); \n}",
          "The goal is to remove the \"tiny sphere\" look caused by the edgeMask and ensure the nebula covers the entire background sphere (radius 300) without any circular borders."
        ]
      },
      "acceptanceCriteria": [
        "`CubeVisualization.tsx` fragment shader contains the user-provided `void main()` block exactly, replacing the previous `void main()` implementation in `BackgroundSphere`.",
        "The fragment shader no longer references or uses `edgeMask` (or equivalent masking) in `void main()`.",
        "When rendering, the background nebula visually covers the full inside of the radius-300 sphere without a circular border/vignette that makes it look like a smaller sphere.",
        "The background sphere continues to animate over time via `uTime` (no regression in uniform updates or animation loop)."
      ]
    }
  ],
  "constraints": [
    "Do not modify files under `frontend/src/components/ui` or any paths listed as immutable in SYSTEM_CONTEXT."
  ],
  "nonGoals": [
    "Do not change the background sphere geometry (keep `sphereGeometry args={[300, 32, 32]}`).",
    "Do not change bloom/tone-mapping calibration settings elsewhere in the scene unless required to make the shader render correctly.",
    "Do not add new background systems or textures; only update the existing fragment shader `void main()` block as requested."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}