{
  "kind": "build_request",
  "title": "Fix Three.js canvas transparency by forcing clear alpha each frame",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In `frontend/src/components/CubeVisualization.tsx`, inside the `BloomEffect` component’s `useFrame` callback, call `gl.setClearAlpha(0)` every frame to force the WebGL renderer to keep a transparent clear alpha even after GLTF/Bloom initialization resets it. Place this call within the existing `if (composerRef.current)` block and ensure it executes before `composerRef.current.render()`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-20"
        ],
        "quotes": [
          "Давай фикс. Внедряй gl.setClearAlpha(0) в useFrame. Жду результат."
        ]
      },
      "acceptanceCriteria": [
        "`frontend/src/components/CubeVisualization.tsx` contains `gl.setClearAlpha(0)` inside `BloomEffect`’s `useFrame` handler.",
        "The change does not remove or disable the existing transparency clear steps (`gl.setClearColor(0x000000, 0)` and `gl.clear(true, true, true)`) and does not remove `<Canvas gl={{ ..., alpha: true }}>`.",
        "When a GLTF model finishes loading and Bloom/EffectComposer is active, the canvas background remains transparent (no black background appears behind the model).",
        "Fullscreen toggle behavior remains unchanged."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under `frontend/src/components/ui` (compose them instead).",
    "Do not modify immutable frontend hook files: `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`.",
    "Keep the current UI styles/layout and the existing stable native fullscreen logic unchanged."
  ],
  "nonGoals": [
    "Do not redesign the page or change the site/theme background.",
    "Do not change bloom strength/radius/threshold tuning except as required for the transparency fix.",
    "Do not introduce new authentication, networking, or backend changes for this fix."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}