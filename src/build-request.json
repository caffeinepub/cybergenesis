{
  "kind": "build_request",
  "title": "Emergency emissive fix for LandModel + add Canvas dithering",
  "projectName": "CyberGenesis PBR Emissive",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update `frontend/src/components/LandModel.tsx` emissive material logic so emissive glow is conditional: if a mesh/material has an `emissiveMap`, keep it and set emissive color to white with `m.userData.baseEmissive = 2.0`; otherwise disable emissive completely by setting emissive to black and `m.userData.baseEmissive = 0.0` (to prevent models without emissive maps from glowing white). Replace only the current emissive block in the material loop, keeping all other behavior unchanged.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6",
          "msg-7"
        ],
        "quotes": [
          "Emergency Fix for LandModel.tsx! We have a \"blindness\" bug on models without emissive maps.\n\nThe logic must be conditional. If a mesh doesn't have an emissive map, it must have ZERO emissive color, otherwise the whole object glows white.\n\nUpdate the Material logic in useEffect as follows:\nReplace the current emissive block (around line 56-65 approx) with this:\nif (obj.material.emissiveMap) {\n    // Model HAS an emissive map\n    m.emissiveMap = obj.material.emissiveMap;\n    m.emissive = new THREE.Color(0xffffff);\n    m.userData.baseEmissive = 2.0; \n} else {\n    // Model HAS NO emissive map - DISABLE glow completely\n    m.emissive = new THREE.Color(0x000000);\n    m.userData.baseEmissive = 0.0;\n}",
          "Собирай! Но другое ничего больше не трогай!! Только то что в промте"
        ]
      },
      "acceptanceCriteria": [
        "For a GLB model whose meshes do not include an emissive map, the rendered object shows no emissive glow (no white glow) and the emissive pulse has no visible effect.",
        "For a GLB model whose meshes include an emissive map, the emissive map is used, emissive color is white, and `m.userData.baseEmissive` is set to `2.0` so existing pulse logic continues to work.",
        "No other logic in `LandModel.tsx` is changed (including `m.dithering = true`, the `useFrame` pulse traversal, biome `envMapIntensity` rules, and camera auto-fit logic)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "In `frontend/src/components/CubeVisualization.tsx`, add `dithering: true` to the `<Canvas gl={{ ... }} />` configuration while keeping existing `gl` settings unchanged.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6",
          "msg-7"
        ],
        "quotes": [
          "2. In CubeVisualization.tsx:\nDon't forget to add dithering: true to the <Canvas gl={{...}} /> if you haven't yet.",
          "Собирай! Но другое ничего больше не трогай!! Только то что в промте"
        ]
      },
      "acceptanceCriteria": [
        "`Canvas` in `CubeVisualization.tsx` includes `gl={{ antialias: true, powerPreference: 'high-performance', alpha: false, dithering: true }}` (ordering may vary) and no other Canvas props/logic are modified.",
        "The app builds successfully with the new `gl.dithering` setting present."
      ]
    }
  ],
  "constraints": [
    "Make only the changes explicitly listed in the user prompt: (1) conditional emissive logic in `frontend/src/components/LandModel.tsx` and (2) add `dithering: true` to `frontend/src/components/CubeVisualization.tsx` Canvas `gl` config.",
    "Do not modify any other files, logic, settings, UI text, or styling beyond these two edits."
  ],
  "nonGoals": [
    "Refactoring LandModel/CubeVisualization structure, performance optimizations, or any changes to bloom/tone mapping/lighting beyond adding `gl.dithering`.",
    "Any backend/canister changes."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}