{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 11,
  "summary": "3D React/Three.js app: continue V.10.1.PBR visual stability work, but replace the blocked @react-three/postprocessing Bloom with a native Three.js UnrealBloomPass implementation from three/examples/jsm inside CubeVisualisation.tsx (50% internal resolution for mobile perf; threshold=1.1, strength=0.35, radius=0.35; keep toneMappingExposure=0.6; use composer.render in the render loop with proper disposal on unmount).",
  "architectural_notes": [
    "Renderer calibration: ACESFilmicToneMapping + SRGBColorSpace with toneMappingExposure=0.6 to prevent over-bright/\"white milk\" at high metalness.",
    "Lighting architecture: key light position synced to camera each frame (useFrame) with specified key/sun/hemi intensities and environment preset=\"sunset\" envIntensity=1.0.",
    "GLTF material policy: call gltf.scene.updateMatrixWorld() before Box3; traverse materials to set emissive/emissiveMap/emissiveIntensity for specified biome name matches; set envMapIntensity by biome; do not override roughness/metalness when roughnessMap exists; avoid m.needsUpdate in traversal loop.",
    "Stability/perf policy: disable shadows on lights; do not manually call gl.dispose() during cleanup.",
    "Environment constraint: cannot install new npm deps (e.g., @react-three/postprocessing); prefer built-in Three.js modules (three/examples/jsm) to avoid imports being removed/rollback during build.",
    "Native Bloom architecture: use EffectComposer + RenderPass + UnrealBloomPass (three/examples/jsm); run composer.render() in the render loop (replacing default render) and dispose composer/pass resources on unmount; use 50% internal resolution for mobile perf (Vector2(innerWidth/2, innerHeight/2))."
  ],
  "known_issues": [
    "Platform draft rollback/rebuild to version 321 intermittently fails with \"AI couldn't implement that\" (non-code/platform limitation).",
    "Published draft/build may not reflect intended code changes (e.g., EffectComposer/Bloom imports/block missing from CubeVisualization.tsx after rebuild), indicating a potential platform/build pipeline inconsistency.",
    "Platform/environment cannot install or persist new npm dependencies (e.g., @react-three/postprocessing); builds may silently remove unsupported imports/rollback files, so Bloom must use Three.js built-in examples modules instead."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-update-frontend-src-components-cubevisualization-tsx-to-match-the-v-10-1-pbr-canvas-and-lighting-specification-set-renderer-tone-mapping-to-three-acesfilmictonemapping-outputcolorspace-to-three-srgbcolorspace-and-tonemappingexposure-to-0-6-in-the-canvas-oncreated-hook-adjust-light-balance-to-keylight-intensity-math-pi-2-2-color-ffffff-sunlight-intensity-math-pi-0-5-color-ffe4b5-hemispherelight-intensity-1-05-skycolor-f7f7f7-groundcolor-3a3a3a-set-environment-preset-sunset-environmentintensity-1-0-and-implement-keylight-camera-sync-using-useframe-so-the-keylight-position-is-set-every-frame-to-camera-x-10-camera-y-15-camera-z-10",
      "title": "Update frontend/src/components/CubeVisualization.tsx to match the V.10.1.PBR Canvas and lighting specification: set renderer tone mapping to THREE.ACESFilmicToneMapping, outputColorSpace to THREE.SRGBColorSpace, and toneMappingExposure to 0.6 in the Canvas onCreated hook; adjust light balance to KeyLight intensity={Math.PI * 2.2} color=\"#ffffff\", SunLight intensity={Math.PI * 0.5} color=\"#ffe4b5\", HemisphereLight intensity={1.05} skyColor=\"#f7f7f7\" groundColor=\"#3a3a3a\"; set <Environment preset=\"sunset\" environmentIntensity={1.0} />; and implement KeyLight camera sync using useFrame so the KeyLight position is set every frame to (camera.x + 10, camera.y + 15, camera.z + 10).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-src-components-landmodel-tsx-to-match-the-v-10-1-pbr-material-traversal-and-camera-fit-safety-rules-call-gltf-scene-updatematrixworld-before-computing-the-box3-perform-material-traversal-only-inside-a-guard-if-gltf-scene-isobject3d-implement-the-emissive-glow-list-behavior-based-on-object-material-name-containing-any-of-mythic-void-mythic-aether-forest-valley-desert-dune-island-archipelago-volcanic-crag-if-m-map-exists-set-m-emissivemap-m-map-set-m-emissive-to-white-and-m-emissiveintensity-to-2-0-implement-per-biome-envmapintensity-rules-based-on-name-aether-void-forest-desert-island-2-0-volcanic-crag-1-3-otherwise-default-1-0-enforce-the-pbr-guard-do-not-manually-set-m-roughness-or-m-metalness-when-m-roughnessmap-exists-and-remove-any-m-needsupdate-true-assignments-from-inside-the-traversal-loop-for-performance",
      "title": "Update frontend/src/components/LandModel.tsx to match the V.10.1.PBR material traversal and camera-fit safety rules: call gltf.scene.updateMatrixWorld() before computing the Box3; perform material traversal only inside a guard `if (gltf.scene?.isObject3D) { ... }`; implement the emissive \"Glow List\" behavior based on object/material name containing any of MYTHIC_VOID, MYTHIC_AETHER, FOREST_VALLEY, DESERT_DUNE, ISLAND_ARCHIPELAGO, VOLCANIC_CRAG (if m.map exists set m.emissiveMap = m.map; set m.emissive to white and m.emissiveIntensity to 2.0); implement per-biome envMapIntensity rules based on name (AETHER/VOID/FOREST/DESERT/ISLAND -> 2.0; VOLCANIC_CRAG -> 1.3; otherwise default 1.0); enforce the PBR guard (do not manually set m.roughness or m.metalness when m.roughnessMap exists); and remove any `m.needsUpdate = true` assignments from inside the traversal loop for performance.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-the-global-stability-constraints-from-v-10-1-pbr-across-the-3d-renderer-components-involved-in-this-task-ensure-no-light-uses-castshadow-true-remove-any-such-props-rather-than-enabling-shadows-and-ensure-no-manual-gl-dispose-is-added-in-any-cleanup-logic-related-to-cubevisualization-landmodel",
      "title": "Apply the global stability constraints from V.10.1.PBR across the 3D renderer components involved in this task: ensure no light uses castShadow={true} (remove any such props rather than enabling shadows), and ensure no manual gl.dispose() is added in any cleanup logic related to CubeVisualization/LandModel.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-in-frontend-src-components-cubevisualization-tsx-implement-bloom-using-native-three-js-examples-modules-effectcomposer-renderpass-unrealbloompass-from-three-examples-jsm-instead-of-any-react-three-postprocessing-based-solution-use-a-50-internal-resolution-for-the-unrealbloompass-new-three-vector2-window-innerwidth-2-window-innerheight-2-for-performance-calibrate-bloom-to-threshold-1-1-strength-0-35-radius-0-35-keep-renderer-tonemappingexposure-synced-to-0-6-do-not-change-existing-tone-mapping-output-color-space-configuration-integrate-composer-rendering-so-the-scene-is-rendered-via-composer-render-i-e-composer-output-replaces-direct-gl-render-and-manage-the-composer-lifecycle-with-react-hooks-add-unmount-cleanup-that-calls-dispose-on-composer-renderpass-and-bloompass-do-not-change-any-existing-light-settings-or-other-v-10-1-pbr-calibration-in-this-component-beyond-adding-removing-bloom-related-code",
      "title": "In frontend/src/components/CubeVisualization.tsx, implement Bloom using native Three.js examples modules (EffectComposer + RenderPass + UnrealBloomPass from three/examples/jsm) instead of any @react-three/postprocessing-based solution. Use a 50% internal resolution for the UnrealBloomPass (new THREE.Vector2(window.innerWidth/2, window.innerHeight/2)) for performance. Calibrate Bloom to threshold=1.1, strength=0.35, radius=0.35. Keep renderer toneMappingExposure synced to 0.6 (do not change existing tone mapping/output color space configuration). Integrate composer rendering so the scene is rendered via composer.render (i.e., composer output replaces direct gl.render) and manage the composer lifecycle with React hooks; add unmount cleanup that calls dispose() on composer, renderPass, and bloomPass. Do not change any existing light settings or other V.10.1.PBR calibration in this component beyond adding/removing Bloom-related code.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Apply V.10.1.PBR canvas/tone-mapping + lighting sync/balance changes in CubeVisualisation.tsx (ACESFilmic, sRGB, exposure=0.6, key light follows camera, environment preset/intensity).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Apply V.10.1.PBR GLTF material traversal rules in LandModel.tsx (updateMatrixWorld before Box3, emissive/glow list, per-biome envMapIntensity, PBR guard for roughness/metalness maps, no needsUpdate in loop).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Global stability changes: remove all castShadow={true} from lights and ensure no manual gl.dispose() in cleanup.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Replace @react-three/postprocessing Bloom with native Three.js examples UnrealBloomPass in CubeVisualisation.tsx: import EffectComposer/RenderPass/UnrealBloomPass from three/examples/jsm; init bloomPass with new THREE.Vector2(window.innerWidth/2, window.innerHeight/2); set threshold=1.1 strength=0.35 radius=0.35; keep toneMappingExposure=0.6; integrate via useEffect/useFrame so composer.render replaces gl.render; dispose composer/renderPass/bloomPass on unmount; do not change existing lights/PBR calibration.",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "3d",
  "projectName": "Apply V.10.1.PBR visual reconstruction and stability lock to CubeVisualization and LandModel",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}