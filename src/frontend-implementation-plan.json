{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "LandModel emissive baseline preservation and pulse scaling",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Initialize each biome mesh material with its intended emissiveIntensity first, then persist the per-mesh baseline to userData.baseEmissive after assignment.",
      "acceptanceCriteria": [
        "When loading different biome models (e.g., `SNOW_PEAK.glb` vs others), meshes retain distinct baseline emissive brightness values rather than being normalized to a single shared value.",
        "`userData.baseEmissive` is written after `emissiveIntensity` is assigned for that mesh/material and matches the final assigned baseline value.",
        "No mesh that should pulse ends up with an incorrect `baseEmissive` due to initialization order."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/LandModel.tsx",
          "operation": "modify",
          "description": "Adjust the model traversal material setup to (1) determine the biome-specific baseline emissiveIntensity per mesh/material (e.g., Snow = 2.0, Plains = 1.3), (2) assign emissive/emissiveMap as needed for pulsing meshes, and only then (3) set `material.userData.baseEmissive = material.emissiveIntensity` so each mesh preserves its unique baseline (including handling multi-material meshes without sharing a single normalized baseline)."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Refine emissive pulsing so the frame loop traverses the rendered group and scales emissiveIntensity from each material's stored baseEmissive.",
      "acceptanceCriteria": [
        "The `useFrame` implementation traverses via `group.current.traverse` and multiplies `baseEmissive` by the pulse factor.",
        "All pulsing biomes “breathe” in sync (same pulse phase), but with different absolute brightness matching their unique baselines (e.g., Snow stays brighter than Plains)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/LandModel.tsx",
          "operation": "modify",
          "description": "Update the `useFrame` loop to traverse via `group.current.traverse(...)` and, for each traversed mesh material that has `userData.baseEmissive` defined, set `emissiveIntensity = baseEmissive * pulse` (including correct handling for meshes with material arrays) so the pulse scales each biome's unique baseline rather than overwriting it."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Enable dithering on all land mesh materials during the same traversal that sets up materials.",
      "acceptanceCriteria": [
        "All `MeshStandardMaterial` instances encountered during model traversal have `dithering` enabled (not only glow meshes)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/LandModel.tsx",
          "operation": "modify",
          "description": "Ensure `dithering = true` is applied to every processed mesh material during the existing scene traversal (including multi-material meshes), keeping the change in the same material setup loop as the emissive baseline initialization."
        }
      ]
    }
  ]
}